codetasty.revision.2.0
{"ts":1497451246,"restoring":false,"user_id":4599,"patch":[{"diffs":[[1,"<?php\n\nnamespace App\\Http\\Controllers;\n\nuse Illuminate\\Http\\Request;\nuse App\\Theme;\nuse Validator;\nuse Lang;\n\nclass ThemeController extends Controller\n{\n    /**\n     * Display a listing of the resource.\n     *\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function index()\n    {\n        $themes = Theme::all();\n        \n        return view('themes.index', [ 'themes' => $themes ]);\n    }\n\n    /**\n     * Show the form for creating a new resource.\n     *\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function create()\n    {\n        return view('themes.create');\n    }\n\n    /**\n     * Store a newly created resource in storage.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function store(Request $request)\n    {\n        $validator = Validator::make($request->all(), [\n            'name' => 'required',\n            'url' => 'required',\n        ]);\n\n        if($validator->fails())\n        {\n            return redirect('/temas/create')\n                ->with(['message' => [\n                    'type' => 'danger',\n                    'text' => 'Comprueba la informaci&oacute;n e intenta nuevamente.'\n                ]\n            ]);\n        }\n\n        $theme = new Theme;\n        $theme->name = $request->name;\n        $theme->url = $request->url;\n        \n        try\n        {\n            $theme->save();\n        }\n        catch(\\Exception $e)\n        {\n            return redirect('/temas/create')\n                ->with(['message' => [\n                    'type' => 'danger',\n                    'text' => 'No se pudo guardar el tema. El servidor respondi&oacute;: ' . $e->getMessage()\n                ]\n            ]);\n        }\n\n        return redirect('temas')\n            ->with(['message' => [\n                'type' => 'success',\n                'text' => 'El tema se ha guardado correctamente.'\n            ]\n        ]);\n    }\n\n    /**\n     * Display the specified resource.\n     *\n     * @param  int  $id\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function show($id)\n    {\n        return view('error.404');\n    }\n\n    /**\n     * Show the form for editing the specified resource.\n     *\n     * @param  int  $id\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function edit($id)\n    {\n        $theme = Theme::find($id);\n\n        if(!$theme) return view('error.404');\n\n        return view('themes.edit', [ 'theme' => $theme ]);\n    }\n\n    /**\n     * Update the specified resource in storage.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @param  int  $id\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function update(Request $request, $id)\n    {\n        $validator = Validator::make($request->all(), [\n            'number' => 'required',\n            'url' => 'required',\n        ]);\n\n        if($validator->fails())\n        {\n            return redirect('/temas/' . $id . '/edit')\n                ->with(['message' => [\n                    'type' => 'danger',\n                    'text' => 'Comprueba la informaci&oacute;n e intenta nuevamente.'\n                ]\n            ]);\n        }\n\n        $theme = Theme::find($id);\n\n        if(!$theme)\n        {\n            return back()\n                ->with(['message' => [\n                    'type' => 'success',\n                    'text' => 'No se encontr&oacute; el tema.'\n                ]\n            ]);\n        }\n\n        if($theme->name !== $request->name)\n            $theme->name = $request->name;\n        if($theme->url !== $request->url)\n            $theme->url = $request->url;\n\n        try\n        {\n            $theme->save();\n        }\n        catch(\\Exception $e)\n        {\n            return redirect('/temas/' . $id . '/edit')\n                ->with(['message' => [\n                    'type' => 'danger',\n                    'text' => 'No se pudo modificar el tema. El servidor respondi&oacute;: ' . $e->getMessage()\n                ]\n            ]);\n        }\n\n        return redirect('/temas/' . $id . '/edit')\n            ->with(['message' => [\n                'type' => 'success',\n                'text' => 'El tema ha sido modificado con &eacute;xito.'\n            ]\n        ]);\n    }\n\n    /**\n     * Remove the specified resource from storage.\n     *\n     * @param  int  $id\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function destroy($id)\n    {\n        $theme = Theme::find($id);\n        \n        if(!$theme)\n            return view('error.404');\n\n        try\n        {\n            $theme->delete();\n        }\n        catch(\\Exception $e)\n        {\n            return back()\n                ->with(['message' => [\n                    'type' => 'danger',\n                    'text' => 'No se pudo eliminar el tema. El servidor respondi&oacute;: ' . $e->getMessage()\n                ]\n            ]);\n        }\n        return redirect('temas')\n            ->with(['message' => [\n                    'type' => 'success',\n                    'text' => 'Tema eliminado con &eacute;xito.'\n            ]\n        ]);\n    }\n    \n    public function use($id)\n    {\n        $theme = Theme::find($id);\n        \n        if(!$theme)\n            return view('error.404');\n            \n        $already_used = Theme::where('used', true)->get();\n        foreach($already_used as $used)\n        {\n            $used->used = false;\n            $used->save();\n        }\n            \n        $theme->used = true;\n\n        try\n        {\n            $theme->save();\n        }\n        catch(\\Exception $e)\n        {\n            return back()\n                ->with(['message' => [\n                    'type' => 'danger',\n                    'text' => 'No se pudo seleccionar el tema. El servidor respondi&oacute;: ' . $e->getMessage()\n                ]\n            ]);\n        }\n        return redirect('temas')\n            ->with(['message' => [\n                    'type' => 'success',\n                    'text' => 'Tema seleccionado con &eacute;xito.'\n            ]\n        ]);\n    }\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":6029}],"length":6029}
{"ts":1497451923,"restoring":false,"user_id":4599,"patch":[{"diffs":[[0,"eturn redirect('"],[-1,"/"],[0,"t"],[1,"h"],[0,"em"],[-1,"a"],[1,"e"],[0,"s/create')\n     "]],"start1":1002,"start2":1002,"length1":37,"length2":37},{"diffs":[[0,"direct('"],[-1,"/"],[0,"t"],[1,"h"],[0,"em"],[-1,"a"],[1,"e"],[0,"s/create"]],"start1":1477,"start2":1477,"length1":21,"length2":21},{"diffs":[[0,"turn redirect('t"],[1,"h"],[0,"em"],[-1,"a"],[1,"e"],[0,"s')\n            "]],"start1":1745,"start2":1745,"length1":35,"length2":36},{"diffs":[[0,"eturn redirect('"],[-1,"/"],[0,"t"],[1,"h"],[0,"em"],[-1,"a"],[1,"e"],[0,"s/' . $id . '/ed"]],"start1":2910,"start2":2910,"length1":37,"length2":37},{"diffs":[[0,"eturn redirect('"],[-1,"/"],[0,"t"],[1,"h"],[0,"em"],[-1,"a"],[1,"e"],[0,"s/' . $id . '/ed"]],"start1":3725,"start2":3725,"length1":37,"length2":37},{"diffs":[[0,"ct('"],[-1,"/"],[0,"t"],[1,"h"],[0,"em"],[-1,"a"],[1,"e"],[0,"s/' "]],"start1":4024,"start2":4024,"length1":13,"length2":13},{"diffs":[[0,"turn redirect('t"],[1,"h"],[0,"em"],[-1,"a"],[1,"e"],[0,"s')\n            "]],"start1":4884,"start2":4884,"length1":35,"length2":36},{"diffs":[[0,"heme::find($id);"],[1," dd($theme);"],[0,"\n        \n      "]],"start1":5139,"start2":5139,"length1":32,"length2":44},{"diffs":[[0,"irect('t"],[1,"h"],[0,"em"],[-1,"a"],[1,"e"],[0,"s')\n    "]],"start1":5850,"start2":5850,"length1":19,"length2":20}],"length":6044}
{"ts":1497452033,"restoring":false,"user_id":4599,"patch":[{"diffs":[[0,"id);"],[-1," dd($theme);"],[0,"\n   "]],"start1":5151,"start2":5151,"length1":20,"length2":8}],"length":6032}